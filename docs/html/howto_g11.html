<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2021b"><title>HOWTO g11: A trick with the minimum and the maximum degree of the synthesis</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S3 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S4 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S6 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>HOWTO g11: A trick with the minimum and the maximum degree of the synthesis</span></h1><div  class = 'S1'><span>You will learn a trick to work with a GGM, the size of which exceeds your RAM.</span></div><div  class = 'S1'><span>The main idea is to slice your GGM into several spectral bands (1st band: "0" ... "nmax1", 2nd band: "nmax1 + 1" ... "nmax2", 3rd band: "nmax2 + 1" ... "nmax3", etc.), each of which is small enough to be stored in RAM at once. Then, you can perform the synthesis for each sliced GGM and, finally, sum the syntheses (outside GrafLab) to the get final result. Certainly, this is substantially slower than using a single GGM, so this procedure should be avoided whenever possible. Nonetheless, with high-degree expansions, GGMs may require tens of GBs of RAM, so this may be the only option if you do not have a sufficient amount of RAM.</span></div><div  class = 'S1'><span>To employ this functionality, the input GGM file must be provided as the binary "mat" file and must contain three variables:</span></div><ul  class = 'S2'><li  class = 'S3'><span>a matrix of an arbitrary name (following the MATLAB's rules) with two columns specifying the spherical harmonic coefficients, [Cnm Snm]; the columns with harmonic degrees and harmonic orders are omitted; the rows of the table</span><span> </span><span style=' font-style: italic;'>must</span><span> follow the structure from "Table 1" from "HOWTO g02" and no other ordering scheme is supported (no check on this is performed by GrafLab!),</span></li><li  class = 'S3'><span>an integer named as "nmin" specifying the minimum degree of the coefficients to be imported,</span></li><li  class = 'S3'><span>an integer names as "nmax" specifying the maximum degree of the coefficients to be imported.</span></li></ul><div  class = 'S1'><span>All the GrafLab input parameters are explained in</span><span> </span><a href = "../docs/graflab.md"><span>../docs/graflab.md</span></a><span>.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >clear; clc; init_checker();</span></span></div></div></div><h2  class = 'S5'><span>Numerical example</span></h2><div  class = 'S1'><span>A GGM file with an incomplete set of spherical harmonic coefficients can be obtained from the enclosed gravity field model "../data/input/EGM96.mat" using the following commands:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >load(</span><span style="color: rgb(170, 4, 249);">'../data/input/EGM96.mat'</span><span >); </span><span style="color: rgb(2, 128, 9);">% Load EGM96, a gravity model up to degree</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >                                 </span><span style="color: rgb(2, 128, 9);">% 360.  Importantly, the coefficients are</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >                                 </span><span style="color: rgb(2, 128, 9);">% stored in agreement with "Table 1".  No</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >                                 </span><span style="color: rgb(2, 128, 9);">% reordering of the coefficients is therefore</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >                                 </span><span style="color: rgb(2, 128, 9);">% necessary.</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >EGM96(EGM96(:, 1) &lt; 100, :) = []; </span><span style="color: rgb(2, 128, 9);">% Delete coefficients below degree 100</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >EGM96(:, 1:2) = []; </span><span style="color: rgb(2, 128, 9);">% Delete information on degrees and orders</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >nmin = 100; </span><span style="color: rgb(2, 128, 9);">% Specify the minimum degree of the coefficients</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >nmax = 360; </span><span style="color: rgb(2, 128, 9);">% Specify the maximum degree of the coefficients</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: rgb(2, 128, 9);">% Finally, save the harmonic band "100" ... "360" of the EGM96 model and</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: rgb(2, 128, 9);">% variables "nmin" and "nmax"</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >GGM_path = </span><span style="color: rgb(170, 4, 249);">'../data/output/EGM96_nmin100_nmax360.mat'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >save(GGM_path, </span><span style="color: rgb(170, 4, 249);">'EGM96'</span><span >, </span><span style="color: rgb(170, 4, 249);">'nmin'</span><span >, </span><span style="color: rgb(170, 4, 249);">'nmax'</span><span >, </span><span style="color: rgb(170, 4, 249);">'-v7.3'</span><span >);</span></span></div></div></div><div  class = 'S1'><span>Now define the rest of the GrafLab input parameters.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >GM                = 3986004.415E+8;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >R                 = 6378136.3;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >ellipsoid         = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >crd               = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >point_type        = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >lat_grd_min       = -90.0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >lat_grd_step      =   1.0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >lat_grd_max       =  90.0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >lon_grd_min       =   0.0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >lon_grd_step      =   1.0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >lon_grd_max       = 360.0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >h_grd             =   0.0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >out_path          = </span><span style="color: rgb(170, 4, 249);">'../data/output/howto-g11-sliced'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >quantity_or_error = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >quantity          = 5;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >fnALFs            = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >export_data_txt   = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >export_report     = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >export_data_mat   = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >display_data      = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >status_bar        = 1;</span></span></div></div></div><div  class = 'S1'><span>Do the synthesis.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >out_sliced = GrafLab(</span><span style="color: rgb(170, 4, 249);">'OK'</span><span >, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    GM, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    R, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    nmin, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    nmax, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    ellipsoid, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    GGM_path, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    crd, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    point_type, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lat_grd_min, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lat_grd_step, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lat_grd_max, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lon_grd_min, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lon_grd_step, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lon_grd_max, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    h_grd, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    out_path, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    quantity_or_error, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    quantity, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    fnALFs, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    export_data_txt, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    export_report, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    export_data_mat, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    display_data, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    status_bar);</span></span></div></div></div><div  class = 'S1'><span>Now let's do the same synthesis but this time with the original full "../data/input/EGM96.mat" model and compare the results with the previous synthesis.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >GGM_path          = </span><span style="color: rgb(170, 4, 249);">'../data/input/EGM96.mat'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >out_path          = </span><span style="color: rgb(170, 4, 249);">'../data/output/howto-g11-full'</span><span >;</span></span></div></div></div><div  class = 'S1'><span>Do the synthesis.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >out_full = GrafLab(</span><span style="color: rgb(170, 4, 249);">'OK'</span><span >, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    GM, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    R, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    nmin, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    nmax, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    ellipsoid, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    GGM_path, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    crd, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    point_type, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lat_grd_min, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lat_grd_step, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lat_grd_max, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lon_grd_min, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lon_grd_step, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    lon_grd_max, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    h_grd, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    out_path, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    quantity_or_error, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    quantity, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    fnALFs, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    export_data_txt, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    export_report, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    export_data_mat, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    display_data, </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    [], </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >    status_bar);</span></span></div></div></div><div  class = 'S1'><span>Now compute the RMS between the two syntheses (should be below "10^-14" or so).</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >fprintf(</span><span style="color: rgb(170, 4, 249);">"RMS of the differences is ""%0.16e"".\n"</span><span >, rms(out_sliced(:, end) - </span><span style="color: rgb(14, 0, 255);">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span >                                                       out_full(:, end)))</span></span></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% HOWTO g11: A trick with the minimum and the maximum degree of the synthesis
% You will learn a trick to work with a GGM, the size of which exceeds your 
% RAM.
% 
% The main idea is to slice your GGM into several spectral bands (1st band: 
% "0" ... "nmax1", 2nd band: "nmax1 + 1" ... "nmax2", 3rd band: "nmax2 + 1" ... 
% "nmax3", etc.), each of which is small enough to be stored in RAM at once. Then, 
% you can perform the synthesis for each sliced GGM and, finally, sum the syntheses 
% (outside GrafLab) to the get final result. Certainly, this is substantially 
% slower than using a single GGM, so this procedure should be avoided whenever 
% possible. Nonetheless, with high-degree expansions, GGMs may require tens of 
% GBs of RAM, so this may be the only option if you do not have a sufficient amount 
% of RAM.
% 
% To employ this functionality, the input GGM file must be provided as the binary 
% "mat" file and must contain three variables:
%% 
% * a matrix of an arbitrary name (following the MATLAB's rules) with two columns 
% specifying the spherical harmonic coefficients, [Cnm Snm]; the columns with 
% harmonic degrees and harmonic orders are omitted; the rows of the table _must_ 
% follow the structure from "Table 1" from "HOWTO g02" and no other ordering scheme 
% is supported (no check on this is performed by GrafLab!),
% * an integer named as "nmin" specifying the minimum degree of the coefficients 
% to be imported,
% * an integer names as "nmax" specifying the maximum degree of the coefficients 
% to be imported.
%% 
% All the GrafLab input parameters are explained in <../docs/graflab.md ../docs/graflab.md>.

clear; clc; init_checker();
%% Numerical example
% A GGM file with an incomplete set of spherical harmonic coefficients can be 
% obtained from the enclosed gravity field model "../data/input/EGM96.mat" using 
% the following commands:

load('../data/input/EGM96.mat'); % Load EGM96, a gravity model up to degree
                                 % 360.  Importantly, the coefficients are
                                 % stored in agreement with "Table 1".  No
                                 % reordering of the coefficients is therefore
                                 % necessary.
EGM96(EGM96(:, 1) < 100, :) = []; % Delete coefficients below degree 100
EGM96(:, 1:2) = []; % Delete information on degrees and orders
nmin = 100; % Specify the minimum degree of the coefficients
nmax = 360; % Specify the maximum degree of the coefficients

% Finally, save the harmonic band "100" ... "360" of the EGM96 model and
% variables "nmin" and "nmax"
GGM_path = '../data/output/EGM96_nmin100_nmax360.mat';
save(GGM_path, 'EGM96', 'nmin', 'nmax', '-v7.3');
%% 
% Now define the rest of the GrafLab input parameters.

GM                = 3986004.415E+8;
R                 = 6378136.3;
ellipsoid         = 1;
crd               = 1;
point_type        = 0;
lat_grd_min       = -90.0;
lat_grd_step      =   1.0;
lat_grd_max       =  90.0;
lon_grd_min       =   0.0;
lon_grd_step      =   1.0;
lon_grd_max       = 360.0;
h_grd             =   0.0;
out_path          = '../data/output/howto-g11-sliced';
quantity_or_error = 0;
quantity          = 5;
fnALFs            = 1;
export_data_txt   = 0;
export_report     = 1;
export_data_mat   = 1;
display_data      = 0;
status_bar        = 1;
%% 
% Do the synthesis.

out_sliced = GrafLab('OK', ...
    GM, ...
    R, ...
    nmin, ...
    nmax, ...
    ellipsoid, ...
    GGM_path, ...
    crd, ...
    point_type, ...
    lat_grd_min, ...
    lat_grd_step, ...
    lat_grd_max, ...
    lon_grd_min, ...
    lon_grd_step, ...
    lon_grd_max, ...
    h_grd, ...
    [], ...
    [], ...
    [], ...
    [], ...
    out_path, ...
    quantity_or_error, ...
    quantity, ...
    fnALFs, ...
    [], ...
    export_data_txt, ...
    export_report, ...
    export_data_mat, ...
    display_data, ...
    [], ...
    [], ...
    [], ...
    [], ...
    status_bar);
%% 
% Now let's do the same synthesis but this time with the original full "../data/input/EGM96.mat" 
% model and compare the results with the previous synthesis.

GGM_path          = '../data/input/EGM96.mat';
out_path          = '../data/output/howto-g11-full';
%% 
% Do the synthesis.

out_full = GrafLab('OK', ...
    GM, ...
    R, ...
    nmin, ...
    nmax, ...
    ellipsoid, ...
    GGM_path, ...
    crd, ...
    point_type, ...
    lat_grd_min, ...
    lat_grd_step, ...
    lat_grd_max, ...
    lon_grd_min, ...
    lon_grd_step, ...
    lon_grd_max, ...
    h_grd, ...
    [], ...
    [], ...
    [], ...
    [], ...
    out_path, ...
    quantity_or_error, ...
    quantity, ...
    fnALFs, ...
    [], ...
    export_data_txt, ...
    export_report, ...
    export_data_mat, ...
    display_data, ...
    [], ...
    [], ...
    [], ...
    [], ...
    status_bar);
%% 
% Now compute the RMS between the two syntheses (should be below "10^-14" or 
% so).

fprintf("RMS of the differences is ""%0.16e"".\n", rms(out_sliced(:, end) - ...
                                                       out_full(:, end)))
##### SOURCE END #####
-->
</div></body></html>